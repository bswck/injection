Rewrote the entire library according to Jelle Zijlstra's 'special key' implementation.